<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>claro.access documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">claro.access</span> <span class="project-version">0.1.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="claro.access.html"><div class="inner"><span>claro.access</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="claro.access.html#var-Read"><div class="inner"><span>Read</span></div></a></li><li class="depth-2"><a href="claro.access.html#var-can-read.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>can-read?</span></div></a></li><li class="depth-1"><a href="claro.access.html#var-Resolve"><div class="inner"><span>Resolve</span></div></a></li><li class="depth-2"><a href="claro.access.html#var-can-resolve.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>can-resolve?</span></div></a></li><li class="depth-1"><a href="claro.access.html#var-wrap-access"><div class="inner"><span>wrap-access</span></div></a></li><li class="depth-1"><a href="claro.access.html#var-wrap-read-access"><div class="inner"><span>wrap-read-access</span></div></a></li><li class="depth-1"><a href="claro.access.html#var-wrap-resolve-access"><div class="inner"><span>wrap-resolve-access</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">claro.access</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-Read"><h3>Read</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for explicit read permission handling. This will, after resolution, decide whether the result should be kept or replaced.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-can-read.3F"><h3>can-read?</h3><div class="usage"><code>(can-read? resolvable env resolution-result)</code></div><div class="doc"><div class="markdown"><p>Check whether the given resolvable is visible, based on the given environment value.</p>
<p>The result value can be either a boolean (with <code>false</code> causing all resolvables to resolve to <code>nil</code>) or an error value.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/xsc/claro.access/blob/master/src/claro/access.cljc#L9">view source</a></div></div><div class="public anchor" id="var-Resolve"><h3>Resolve</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for explicit resolution permission handling. This will, <strong>before resolution</strong>, decide whether the underlying resolvable should be run or not.</p>
<p>This is mainly useful for mutations.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-can-resolve.3F"><h3>can-resolve?</h3><div class="usage"><code>(can-resolve? resolvable env)</code></div><div class="doc"><div class="markdown"><p>Check whether the given resolvable shall be resolved, based on the given environment value.</p>
<p>The result value can be a deferred containing either a boolean (with <code>false</code> causing all resolvables to resolve to <code>nil</code>) or an error value.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/xsc/claro.access/blob/master/src/claro/access.cljc#L19">view source</a></div></div><div class="public anchor" id="var-wrap-access"><h3>wrap-access</h3><div class="usage"><code>(wrap-access engine)</code></div><div class="doc"><div class="markdown"><p>Wrap the given engine with both <a href="claro.access.html#var-wrap-read-access">wrap-read-access</a> and <a href="claro.access.html#var-wrap-resolve-access">wrap-resolve-access</a>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro.access/blob/master/src/claro/access.cljc#L151">view source</a></div></div><div class="public anchor" id="var-wrap-read-access"><h3>wrap-read-access</h3><div class="usage"><code>(wrap-read-access engine)</code></div><div class="doc"><div class="markdown"><p>Use the <a href="claro.access.html#var-Read">Read</a> protocol to decide whether the result of a resolvableâ€™s resolution should be returned or not.</p>
<pre><code class="clojure">(defrecord Wishlist [id]
  data/Resolvable
  ...

  access/Read
  (can-read? [_{:keys [session]} {:keys [creator_id]}]
    (= (:person-id session) creator_id)))
</code></pre>
<p>Basically, this middleware can be used <em>after</em> resolution to enforce read permissions based on the returned result.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro.access/blob/master/src/claro/access.cljc#L123">view source</a></div></div><div class="public anchor" id="var-wrap-resolve-access"><h3>wrap-resolve-access</h3><div class="usage"><code>(wrap-resolve-access engine)</code></div><div class="doc"><div class="markdown"><p>Use the <a href="claro.access.html#var-Resolve">Resolve</a> protocol to decide whether a batch of resolvables should be attempted to be resolved.</p>
<pre><code class="clojure">(defrecord AddToWishlist [id item-id]
  data/Mutation
  data/Resolvable
  ...

  access/Resolve
  (can-resolve? [_ {:keys [session]}]
    (d/future
      (let [{:keys [creator_id]} (fetch-wishlist! id)]
        (= (:id session) creator_id))))))
</code></pre>
<p>Basically, this middleware can be used <em>before</em> resolution to enforce permissions and is able to perform queries to allow for better decision making.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro.access/blob/master/src/claro/access.cljc#L82">view source</a></div></div></div></body></html>